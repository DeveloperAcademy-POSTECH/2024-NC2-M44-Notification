# üì± DiaryNotification
NC2 Notification study of Ace and Groo

## üñºÔ∏è Prototype

### Í∏∞Î≥∏ prototype

ÌïôÏÉùÏù¥ ÏùºÍ∏∞Î•º ÏûëÏÑ±ÌïòÍ≥† Ï†úÏ∂úÌïòÎ©¥ ÏÑ†ÏÉùÎãòÏù¥ ÏùºÍ∏∞Î•º ÌôïÏù∏ÌïòÍ≥† ÎèÑÏû•ÏùÑ Ï∞çÎäîÎã§.

https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M44-Notification/assets/77305722/7ee52c02-8fb1-4a8d-86d2-dcdad94f0124

### Local notification

ÌïôÏÉùÏù¥ ÏßÄÏ†ïÌïú ÏãúÍ∞ÑÏóê ÏùºÍ∏∞ ÏûëÏÑ± ÏïåÎ¶ºÏùÑ Î∞õÎäîÎã§. Íæπ ÎàåÎü¨ÏÑú Ïï±Ïóê Îì§Ïñ¥Í∞ÄÏßÄ ÏïäÍ≥†ÎèÑ ÏùºÍ∏∞Î•º ÏûëÏÑ±Ìï† Ïàò ÏûàÎã§.

https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M44-Notification/assets/77305722/d6b8c9c0-f0ab-48da-90da-2cec1bd7aa2a

### Remote notification

ÌïôÏÉùÏù¥ ÏùºÍ∏∞Î•º Ï†úÏ∂úÌïòÎ©¥ ÏÑ†ÏÉùÎãòÏóêÍ≤å ÏùºÍ∏∞Ïùò ÎÇ¥Ïö©Ïù¥ Îã¥Í∏¥ ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°ÎêúÎã§.

https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M44-Notification/assets/77305722/c049a275-4fc9-452a-babd-0d2bc425f874

## üé• Youtube Link
(Ï∂îÌõÑ ÎßåÎì§Ïñ¥ÏßÑ Ïú†ÌäúÎ∏å ÎßÅÌÅ¨ Ï∂îÍ∞Ä)

## üí° About Notification

### Local Notification

ÏãúÍ∞Ñ, Í≥µÍ∞ÑÏù¥ÎùºÎäî triggerÎ•º Ïù¥Ïö©ÌïòÏó¨ ÎîîÎ∞îÏù¥Ïä§Î°ú ÏïåÎ¶ºÏùÑ Î≥¥ÎÇ∏Îã§. notificationÏùÑ ÌÜµÌï¥ ÏÇ¨Ïö©ÏûêÏóêÍ≤å Ï†ÅÏ†àÌïú ÎïåÏóê Ï†ÅÏ†àÌïú ÌòïÌÉú ÏïåÎ¶ºÏùÑ Ï†úÍ≥µÌï®ÏúºÎ°úÏç® Îã®ÏàúÌûà Î¶¨ÎßàÏù∏ÎìúÍ∞Ä ÏïÑÎãå ÌäπÏ†ï ÌñâÎèôÏùÑ Í∂åÏú†Ìï† Ïàò ÏûàÎã§.

### Remote Notification

ÏõêÍ≤©ÏóêÏÑú ÌäπÏ†ï Ìä∏Î¶¨Í±∞Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ïñ¥ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùò ÏïåÎ¶ºÏùÑ Î∞úÏÉùÏãúÌÇ§Îäî Í∏∞Ïà†Ïù¥Îã§.

## üéØ What we focus on?

- **Trigger**: Local NotificationÏùò Í≤ΩÏö∞ ÏãúÍ∞Ñ, Í≥µÍ∞ÑÏùÑ Trigger Î°ú ÏÇ¨Ïö©ÌïòÏó¨ ÏïåÎ¶ºÏùÑ Ï§Ñ Ïàò ÏûàÎã§. Í∑∏ Ï§ë ÏãúÍ∞ÑÏù¥ Í≥ÑÌöçÍ≥º Î∞ÄÏ†ëÌïòÍ∏∞ÎèÑ ÌïòÍ≥†, ÏãúÍ∞ÑÏù¥ÎçîÎùºÎèÑ ÌÉÄÏù¥Î®∏, ÌäπÏ†ï ÎÇ†Ïßú, ÌäπÏ†ï ÏãúÍ∞Ñ Îì±Ïóê Îî∞Îùº Îã¨Î¶¨ ÏïåÎûåÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏñ¥ÏÑú Ïï±Ïùò use caseÏùò Ï†ÅÏ†àÌïú ÏïåÎ¶ºÏùÑ Íµ¨ÌòÑÌïòÍ≥†Ïûê ÌñàÎã§.
- **Notification Action**: ÏïåÎ¶ºÏùÑ Î∞õÍ≥† Îã®ÏàúÌûà Ïï±ÏúºÎ°ú Ï†ëÍ∑ºÌïòÎäî Í≤ÉÏù¥ ÏïÑÎãàÎùº, Ïï±Ïóê Îì§Ïñ¥Ïò§ÏßÄ ÏïäÏïÑÎèÑ ÎØ∏Î¶¨ ÏÑ§Ï†ïÌïú Í≥ºÏ†ïÏùÑ Ïã§ÌñâÌï† Ïàò ÏûàÍ≤å ÌïòÏó¨ ÏÇ¨Ïö©ÏûêÏùò Ìé∏Î¶¨ÏÑ±ÏùÑ ÎÜíÏù¥Í≥† Î™©Ï†ÅÏóê Î∂ÄÌï©ÌïòÎäî ÏïåÎ¶ºÏùÑ Î≥¥ÎÇ¥Í≥†Ïûê ÌñàÎã§.
- **Text Input Action:** Notification action Ï§ëÏóê Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎäî Í≤ÉÏóêÏÑúÎßå ÎÅùÎÇòÎäî Í≤å ÏïÑÎãàÎùº Î∞îÎ°ú ÌïÑÏöîÌïú ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•Ìï† Ïàò ÏûàÎäî Í≤ÉÏúºÎ°ú, use caseÏóê Ï†ÅÏ†àÌïú ÏïåÎ¶ºÏùÑ Íµ¨ÌòÑÌïòÍ≥†Ïûê ÌñàÎã§.
- **Remote Notification** Ïùò Í≤ΩÏö∞ ÏÑúÎ≤ÑÏóêÏÑú ÏõêÌïòÎäî ÎåÄÎ°ú triggerÎ•º ÏßÄÏ†ïÌï† Ïàò ÏûàÎã§. ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö©Ïóê ÎßûÏ∂∞ ÏïåÎ¶ºÏùÑ Ï†ÑÏÜ°ÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÌïÑÏàòÏù¥Îã§. Ìë∏Ïãú ÏïåÎ¶ºÏùÑ Íµ¨ÌòÑÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî APNs Î•º Ìè¨Ìï®Ìïú Ïó¨Îü¨ Îã®Í≥ÑÎ•º Í±∞Ï≥êÏïº ÌïòÎäîÎç∞, Ìï¥Îãπ Ïù∏ÌîÑÎùºÎ•º Íµ¨Ï∂ïÌïòÎäî Î≤ïÏóê ÎåÄÌï¥ ÏßëÏ§ëÌñàÎã§.

## üíº Use Case

> Ï†ÅÏ†àÌïú ÏïåÎ¶ºÏùÑ Ï£ºÏñ¥ ÌïôÏÉùÏùÄ ÏùºÏ†ïÌïú ÏãúÍ∞ÑÏóê ÏùºÍ∏∞Î•º ÏûëÏÑ±ÌïòÍ≥†, ÏÑ†ÏÉùÎãòÏùÄ ÌïôÏÉùÏù¥ Ï†úÏ∂úÌïú ÏùºÍ∏∞Î•º ÌôïÏù∏ÌïòÍ≤å ÌïòÏûê.

## üõ†Ô∏è About Code

### Local Notification

---

**ÏãúÍ∞ÑÏùÑ triggerÎ°ú ÏïåÎ¶º ÏÑ§Ï†ïÌïòÍ∏∞**

```swift
let dateComponents = Calendar.current.dateComponents([.hour, .minute], from: date) 
trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents, repeats: true)
```

**Î≥¥ÎÇ¥Îäî ÏïåÎ¶ºÏùò category ÏÑ§Ï†ïÌïòÍ∏∞**

```swift
let textAction = UNTextInputNotificationAction(
    identifier: "TEXT_ACTION",
    title: "Í∞ÑÎã®ÌïòÍ≤å ÏùºÍ∏∞ Ïì∞Í∏∞",
    options: [],
    textInputButtonTitle: "Ï†úÏ∂ú",
    textInputPlaceholder: "ÏùºÍ∏∞Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
)

let basicNotificationCategory = UNNotificationCategory(
    identifier: "STUDENT_NOTIFICATION",
    actions: [textAction, acceptAction],
    intentIdentifiers: [],
    hiddenPreviewsBodyPlaceholder: "ÏùºÍ∏∞Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî",
    options: .customDismissAction
)
```

**ÏàòÏã†Ìïú ÏïåÎ¶ºÏùò categoryÏóê Îî∞Îùº action ÏÑ§Ï†ïÌïòÍ∏∞**

```swift
func userNotificationCenter(
	_ center: UNUserNotificationCenter,
	didReceive response: UNNotificationResponse,
	withCompletionHandler completionHandler: @escaping () -> Void
) { 
	if response.notification.request.content.categoryIdentifier == "STUDENT_NOTIFICATION" { 
		switch response.actionIdentifier { 
			case "TEXT_ACTION": 
				print("didReceive: text input‚Äù)
				if let userInput = (response as? UNTextInputNotificationResponse)?.userText { 
					print(userInput) 
					UserDefaults.standard.set(userInput, forKey: "diary") 
					UserDefaults.standard.set(true, forKey: "isDiarySubmitted") 
					// ‚Ä¶
```

### Remote Notification

---

**APNs Îì±Î°ù ÌõÑ ÎîîÎ∞îÏù¥Ïä§ ÌÜ†ÌÅ∞ ÏöîÏ≤≠**

```swift
application.registerForRemoteNotifications()
```

**ÎîîÎ∞îÏù¥Ïä§ ÌÜ†ÌÅ∞ DB ÏÑúÎ≤ÑÏóê Ï†ÄÏû•**

```swift
private func saveUserTokenToFirestore(userId: String, token: String) {
   db.collection("users").document(userId).
       setData(["fcmToken": token], merge: true) { error in
       // ..
   }
}
```

**FCM ÌÜ†ÌÅ∞ ÏÉùÏÑ±**

```swift
func messaging(_ messaging: Messaging,
               didReceiveRegistrationToken fcmToken: String?) {
	let dataDict: [String: String] = ["token": fcmToken ?? ""]
	NotificationCenter.default.post(
		name: Notification.Name("FCMToken"),
    object: nil,
    userInfo: dataDict
  )
}
```

**Firebase Functions Ìò∏Ï∂ú**

```swift
func sendNotificationToUser
    (userId: String,title: String, body: String) {
    let data: [String: Any] = [
        "userId": userId,
        "title": title,
        "body": body
    ]
    functions.httpsCallable("sendNotification").call(data)
        { result, error in
        //..
    }
}
```

**Firebase Function ÏóêÏÑú ÏïåÎ¶º Ï†ÑÏÜ° (JavaScript)**

```jsx
exports.sendNotification = onCall(async (data, context) => {
    const { userId, title, body } = data;
    //..
    const userDoc = await getFirestore().
                         collection('users').doc(userId).get();
    const fcmToken = userDoc.data().fcmToken;
    const message = {
        notification: {
            title: title,
            body: body
        },
        token: fcmToken
    };
        await admin.messaging().send(message);
		    //..
    }
}
```

## :people_hugging: Authors

|<img src="https://avatars.githubusercontent.com/u/82134672?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/77305722?v=4" width="150" height="150"/>|
|:-:|:-:|
|Groo<br/>[@treesofgroo](https://github.com/treesofgroo)|Ïù¥ÏÉÅÌòÑ Ace<br/>[@dgh06175](https://github.com/dgh06175)|
